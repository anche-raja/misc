---
type: specs.openrewrite.org/v1beta/recipe
name: com.yourcompany.UpgradeStruts600To674Complete
displayName: Complete Struts 6.0.0 to 6.7.4 Migration
description: |
  Comprehensive migration recipe covering ALL breaking changes from Struts 6.0.0 to 6.7.4.
  This includes package migrations, method renames, interceptor changes, and file upload updates.
  Struts 6.7.4 is the latest stable version that supports Java 8.

recipeList:
  # ========================================================================
  # 1. PACKAGE MIGRATIONS - Aware Interfaces (CRITICAL - Will cause compile errors!)
  # ========================================================================
  # All "Aware" interfaces moved from org.apache.struts2.interceptor to org.apache.struts2.action
  
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.apache.struts2.interceptor.ApplicationAware
      newFullyQualifiedTypeName: org.apache.struts2.action.ApplicationAware
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.apache.struts2.interceptor.SessionAware
      newFullyQualifiedTypeName: org.apache.struts2.action.SessionAware
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.apache.struts2.interceptor.ParameterAware
      newFullyQualifiedTypeName: org.apache.struts2.action.ParameterAware
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.apache.struts2.interceptor.HttpParametersAware
      newFullyQualifiedTypeName: org.apache.struts2.action.HttpParametersAware
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.apache.struts2.interceptor.PrincipalAware
      newFullyQualifiedTypeName: org.apache.struts2.action.PrincipalAware
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.apache.struts2.interceptor.ServletRequestAware
      newFullyQualifiedTypeName: org.apache.struts2.action.ServletRequestAware
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.apache.struts2.interceptor.ServletResponseAware
      newFullyQualifiedTypeName: org.apache.struts2.action.ServletResponseAware
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.apache.struts2.util.ServletContextAware
      newFullyQualifiedTypeName: org.apache.struts2.action.ServletContextAware
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.apache.struts2.interceptor.CookiesAware
      newFullyQualifiedTypeName: org.apache.struts2.action.CookiesAware

  # ========================================================================
  # 2. METHOD RENAMES - set* to with* for Aware interfaces
  # ========================================================================
  
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.apache.struts2.action.ApplicationAware setApplication(java.util.Map)
      newMethodName: withApplication
      matchOverrides: true
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.apache.struts2.action.SessionAware setSession(java.util.Map)
      newMethodName: withSession
      matchOverrides: true
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.apache.struts2.action.ParameterAware setParameters(java.util.Map)
      newMethodName: withParameters
      matchOverrides: true
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.apache.struts2.action.HttpParametersAware setParameters(org.apache.struts2.dispatcher.HttpParameters)
      newMethodName: withParameters
      matchOverrides: true
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.apache.struts2.action.PrincipalAware setPrincipalProxy(org.apache.struts2.interceptor.PrincipalProxy)
      newMethodName: withPrincipalProxy
      matchOverrides: true
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.apache.struts2.action.ServletRequestAware setServletRequest(javax.servlet.http.HttpServletRequest)
      newMethodName: withServletRequest
      matchOverrides: true
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.apache.struts2.action.ServletResponseAware setServletResponse(javax.servlet.http.HttpServletResponse)
      newMethodName: withServletResponse
      matchOverrides: true
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.apache.struts2.action.ServletContextAware setServletContext(javax.servlet.ServletContext)
      newMethodName: withServletContext
      matchOverrides: true
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.apache.struts2.action.CookiesAware setCookiesMap(java.util.Map)
      newMethodName: withCookiesMap
      matchOverrides: true

  # ========================================================================
  # 3. FILE UPLOAD INTERCEPTOR CHANGES (Since Struts 6.4.0)
  # ========================================================================
  # FileUploadInterceptor is deprecated in favor of ActionFileUploadInterceptor
  # This change requires implementing UploadedFilesAware interface instead of using setters
  
  # Add the new interface to actions that need file uploads
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.apache.struts2.interceptor.FileUploadInterceptor
      newFullyQualifiedTypeName: org.apache.struts2.interceptor.ActionFileUploadInterceptor

  # ========================================================================
  # 4. OPENSYMPHONY TO STRUTS PACKAGE MIGRATIONS
  # ========================================================================
  
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: com.opensymphony.xwork2.config.providers.XmlConfigurationProvider
      newFullyQualifiedTypeName: org.apache.struts2.config.StrutsXmlConfigurationProvider
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: com.opensymphony.xwork2.conversion.TypeConversionException
      newFullyQualifiedTypeName: org.apache.struts2.conversion.TypeConversionException
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: com.opensymphony.xwork2.XWorkException
      newFullyQualifiedTypeName: org.apache.struts2.StrutsException

  # ========================================================================
  # 5. FREEMARKER CHANGES (Auto-escaping enabled by default)
  # ========================================================================
  # Note: Manual intervention required to remove ?html from FreeMarker templates
  # This is handled in XML/config changes below

  # ========================================================================
  # 6. DEPENDENCY VERSION UPGRADES
  # ========================================================================
  
  - org.openrewrite.java.dependencies.UpgradeDependencyVersion:
      groupId: org.apache.struts
      artifactId: "*"
      newVersion: 6.7.4
  
  # ========================================================================
  # 7. MAVEN PROPERTY UPDATES
  # ========================================================================
  
  - org.openrewrite.maven.ChangePropertyValue:
      key: struts2.version
      newValue: 6.7.4
  - org.openrewrite.maven.ChangePropertyValue:
      key: struts.version
      newValue: 6.7.4
  - org.openrewrite.maven.ChangePropertyValue:
      key: struts2-version
      newValue: 6.7.4

  # ========================================================================
  # 8. XML CONFIGURATION UPDATES
  # ========================================================================
  
  # Update interceptor references from fileUpload to actionFileUpload
  - org.openrewrite.xml.ChangeTagValue:
      elementName: interceptor-ref
      attributeName: name
      attributeValue: fileUpload
      newValue: actionFileUpload
